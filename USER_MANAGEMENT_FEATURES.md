# KubeSwitch - 用户管理功能增强

## 新增功能

在用户管理页面中，根据用户角色和身份提供不同的操作按钮：

### 1. 普通用户功能

#### 修改密码 (Change Password) - 蓝色按钮
- 用户只能看到自己的"修改密码"按钮
- 需要输入当前密码进行验证
- 新密码需要确认输入
- 密码长度至少6位字符

### 2. 管理员功能

管理员除了可以修改自己的密码外，还可以对其他用户进行以下操作：

#### 重置密码 (Reset Password) - 橙色按钮
- 管理员可以直接重置任何用户的密码
- 无需知道用户的当前密码
- 新密码需要确认输入
- 自动记录审计日志

#### 修改角色 (Change Role) - 紫色按钮
- 管理员可以修改用户的角色（user/admin）
- 支持在用户和管理员角色之间切换
- 自动记录审计日志

#### 删除用户 (Delete) - 红色按钮
- 管理员可以删除普通用户
- 不能删除管理员用户（安全保护）
- 删除前需要确认操作
- 自动清理用户的所有权限
- 自动记录审计日志

### 3. 权限管理 (Permissions) - 默认按钮
- 所有用户都可以查看，管理员可以修改
- 管理集群访问权限

## 界面设计

### 按钮颜色编码
- **蓝色**：修改密码（当前用户）
- **橙色**：重置密码（管理员操作）
- **紫色**：修改角色（管理员操作）
- **红色**：删除用户（管理员操作）
- **默认色**：权限管理

### 权限控制
- **当前用户**：只能看到自己的"修改密码"按钮
- **管理员**：可以看到所有操作按钮，但不能删除其他管理员
- **安全保护**：防止管理员意外删除自己或其他管理员

## 技术实现

### 后端 API

#### 用户自助功能
- `POST /api/my/password` - 用户修改自己的密码

#### 管理员功能
- `DELETE /api/users/:id` - 删除用户
- `POST /api/users/:id/password` - 管理员重置用户密码
- `POST /api/users/:id/role` - 修改用户角色

### 前端组件
- 使用Ant Design的Button、Modal、Form组件
- Popconfirm组件用于删除确认
- 根据当前用户角色动态显示按钮
- 表单验证确保密码安全性

## 安全特性

### 密码安全
- 修改密码需要验证当前密码
- 新密码需要确认输入
- 密码长度限制（最少6位）
- 密码使用bcrypt加密存储

### 权限控制
- 用户只能修改自己的密码
- 管理员不能删除其他管理员
- 所有操作都需要认证
- 管理员操作需要额外权限验证

### 审计日志
- 所有密码修改操作都记录审计日志
- 用户删除操作记录审计日志
- 角色修改操作记录审计日志
- 包含操作者、目标用户、操作类型等信息

## 使用方法

### 普通用户
1. 登录系统后进入用户管理页面
2. 在自己的用户行中点击"Change Password"按钮
3. 输入当前密码和新密码
4. 确认新密码后提交

### 管理员操作
1. 登录管理员账户
2. 进入用户管理页面
3. 在目标用户行选择相应操作：
   - **Reset Password**: 直接设置新密码
   - **Change Role**: 修改用户角色
   - **Delete**: 删除用户（需确认）

## 数据库变更

无需额外的数据库变更，使用现有的用户表和权限表。

## 注意事项

- 管理员账户不能被删除，确保系统始终有管理员
- 删除用户会同时清理其所有集群权限
- 密码重置后建议用户首次登录时修改密码
- 角色修改会立即生效，用户需要重新登录
- 所有敏感操作都会记录到审计日志中